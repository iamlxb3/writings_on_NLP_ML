### 实验目的

为了持续利用数据迭代nlu模型的效果，目前有两种方式，第一种方式是标注线上数据（模型辅助选择标注数据），第二种方式是直接创作文本，**此实验的目的是为了比较两种方式的优劣，基于此规划后续的标注方案**。

### 实验数据

此次数据从小西chatbot NLU2.0版本的数据中截取，包含24个意图，全部出自实验室文案，并且由文案专人（小草）编写了测试集。标注语料的候选集来自20w条线上与小孩chatbot交互的数据，并且筛选模型置信度在0.1-0.9之间的数据(占比1%，每一类平均占比0.04%)；创作语料4300条数量可观，主要是因为目前采用了特殊的"扩写"方法，能比较有效地扩充数量。

#### 标注数量与成本

|      | 花费  | 新增语料数量 | 模型提升效果(取置信度阈值0.8) |
| ---- | ----- | ------------ | ----------------------------- |
| 创作 | 230元 | 4300条       | 9%                            |
| 标注 | 238元 | 2380条       | 5%                            |

### 模型结构

此实验的模型结构与nlu在线训练的模型完全一致，采用了bert+fasttext抽特征，之后训练下游分类器的方法，并且结合了ensemble的方法。示意图如下：

![image-20191030110555336](/Users/jiashupu/writings_on_NLP_ML/image-20191030110555336.png)

### 结果与分析

此实验为分类任务，以下为测试集上的结果，其中annotate，origin，write分别代表标注的数据，原始数据及创作的数据。图标的x轴为置信度的阈值，三种图中的y轴分别为正样本的marco_f1，负样本的f1，及两者平均的f1。

![marco_f1](/Users/jiashupu/writings_on_NLP_ML/marco_f1-2400740.png)

​              图1. 正样本的marco_f1值，标注数据的提升非常有限，而创作数据在阈值高时的提升非常明显

![other_marco_f1](/Users/jiashupu/writings_on_NLP_ML/other_marco_f1.png)

图2. 负样本的f1值，标注数据的提升很明显，而创作数据甚至在置信度低时不如原始语料，可能的原因是负采样   比例下降

![avg_marco_f1](/Users/jiashupu/writings_on_NLP_ML/avg_marco_f1.png)

图3. 正样本与负样本平均marco_f1值，总体来说在置信度低时标注数据占优势，在置信度高时创作语料提升显著

**结果分析**：创作语料对正样本的预测效果提升明显，标注语料对负样本的效果提升明显，这与其本身数据的性质也是相符的，标注语料中有较多负样本。**创作语料更符合目前的需求（较高阈值下优先保证样本的precision）**。

**创作与标注的优缺点比较**：

|                                          | 标注语料 | 创作语料 |
| ---------------------------------------- | -------- | -------- |
| 不需要大量原始语料                       | ✘        | ✓        |
| 新增数据较为平衡(每个类新增数量差不多)   | ✘        | ✓        |
| 能提供质量较高的负样本                   | ✓        | ✘        |
| 不需要模型参与建立样本候选集及标签候选集 | ✘        | ✓        |

### 在新浪微博上的数据分布

另外做了一个小实验，使用了小西chatbot2.0版本的nlu在新浪微博语料上跑了一下，采样了10万，数据分布如下：预测top-1中非other占比仅2.76%，并且长尾效应严重，类与类之间数量的差距最高在200倍。

### 结论

1. "模型选择样本-人工标注"这一种方式能提供的正样本非常有限，必须在前期积累大量数据，且数据不平衡，但是能提供较高质量的负样本，对提升模型的负样本预测有明显效果。
2. "直接创作文本"能大体保证数据平衡，并且前期不需要模型参与获取样本，**实验结果与目前对模型的预期比较相符，故希望目前以直接创作语料为主。**
3. 之后可以考虑创作"负样本"，以弥补目前创作语料的不足。
4. 对于线上大量负样本，必须合理利用，后续会调研相关聚类方法，并撰写技术方案，并且将人力有效地结合进来。